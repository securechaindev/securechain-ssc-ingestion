from typing import Any

from src.services.dbs import get_vulnerabilities_collection


class VulnerabilityService:
    def __init__(self):
        self._vulnerabilities_collection = get_vulnerabilities_collection()

    async def read_vulnerabilities_by_package_and_version(self, package_name: str, version_name: str) -> dict[str, Any]:
        result = await self._vulnerabilities_collection.find(
            {
                "affected.package.name": package_name,
                "affected.versions": version_name
            }
        ).to_list(length=None)
        return result if result else {}
