from typing import Any

from src.database import DatabaseManager


class VulnerabilityService:
    def __init__(self, db: DatabaseManager):
        self.vulnerabilities_collection = db.get_vulnerabilities_collection()

    async def read_vulnerabilities_by_package_and_version(self, package_name: str, version_name: str) -> dict[str, Any]:
        result = await self.vulnerabilities_collection.find(
            {
                "affected.package.name": package_name,
                "affected.versions": version_name
            }
        ).to_list(length=None)
        return result if result else {}
